name: Daily Competition Monitor

on:
  schedule:
    # 每天北京时间 08:00 运行 (GitHub用的是UTC时间，所以设为 00:00)
    - cron: '0 0 * * *'
  workflow_dispatch: # 允许你手动点击按钮触发测试

permissions:
  contents: write # 赋予这个脚本修改仓库文件的权限(为了保存history.json)

jobs:
  run-monitor:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code (下载代码)
      uses: actions/checkout@v3
      
    - name: Set up Python (安装Python)
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies (安装依赖)
      run: |
        pip install -r requirements.txt
        
    - name: Run Monitor Script (运行爬虫)
      env: 
        # 把保险箱里的钥匙取出来，注入到环境变量
        MY_AI_KEY: ${{ secrets.MY_AI_KEY }}
        MY_SERVER_KEY: ${{ secrets.MY_SERVER_KEY }}
      run: python monitor_new_cloud.py
      
    - name: Commit and Push History (保存记忆)
      # 只有当 history.json 发生变化时才提交
      run: |
        git config --global user.name "GitHub Action Bot"
        git config --global user.email "actions@github.com"
        git add history.json
        git commit -m "Update competition history" || echo "No changes to commit"
        git push
